# 점잇기 퍼즐 생성기 - PRD (Product Requirements Document)

**문서 버전**: 3.0 (클라이언트 사이드 + Web Worker)
**작성일**: 2025년 10월 24일
**프로젝트**: 이미지 기반 점잇기 퍼즐 자동 생성기
**플랫폼**: Next.js 15 웹 애플리케이션 (Web Worker 기반 클라이언트 처리)

---

## 1. 개요

### 1.1. 프로젝트 배경

점잇기 퍼즐을 좋아하는 4살 딸은 시중의 퍼즐 책 한 권을 하루 만에 끝내버립니다. 아이에게 더 많은 즐거움을 주고 싶지만, 매번 새 책을 사는 것은 비용적으로 부담이 됩니다. 이 프로젝트는 사랑하는 딸에게 세상에 단 하나뿐인, 무한한 점잇기 퍼즐을 선물하고 싶은 아빠의 마음에서 시작되었습니다.

### 1.2. 제품 목표

사용자가 원하는 어떤 이미지든 브라우저에서 몇 번의 클릭만으로 아이의 눈높이에 맞는 점잇기 퍼즐로 변환하고, 바로 다운로드하여 인쇄할 수 있는 **완전 무료 웹 애플리케이션**을 개발합니다.

**핵심 가치**
- **무료**: 서버 비용이 없으므로 영구 무료
- **빠름**: 서버 왕복 없이 브라우저에서 즉시 처리
- **프라이버시**: 이미지가 서버에 전송되지 않음
- **간단함**: 설치 불필요, 링크만 공유하면 됨

### 1.3. 타겟 사용자

* **주 사용층 (부모)**: 자녀에게 맞춤형 교육/놀이 자료를 직접 만들어주고 싶어 하는 부모. 스마트폰이나 컴퓨터 기본 사용에 익숙하지만, 전문적인 디자인이나 프로그래밍 지식은 없음.
* **최종 사용자 (아이)**: 3~7세의 유아 및 초등 저학년. 아직 복잡한 그림보다는 단순하고 명확한 형태의 퍼즐을 선호하며, 점의 개수가 너무 많지 않아야 흥미를 잃지 않음.
* **부 사용층**: 유치원 교사, 초등학교 교사, 홈스쿨링 부모

---

## 2. 핵심 기능 및 사용자 스토리

### 2.1. 최소 기능 제품(MVP) 범위

| 기능 ID | 사용자 스토리 | 상세 기능 요구사항 | 우선순위 | 처리 위치 |
|---------|---------------|-------------------|----------|-----------|
| F-01 | 이미지 불러오기 | "나는 부모로서, 아이가 좋아하는 캐릭터나 동물 사진을 퍼즐로 만들어주기 위해 내 기기에 저장된 이미지 파일(JPG, PNG)을 브라우저에서 바로 불러올 수 있어야 한다." | 필수 | 클라이언트 |
| F-02 | 난이도 조절 | "나는 부모로서, 아이의 수준에 맞춰 점의 개수를 10~100개 범위에서 조절하여 퍼즐을 쉽게 또는 약간 어렵게 만들 수 있어야 한다." | 필수 | 클라이언트 |
| F-03 | 퍼즐 생성 및 미리보기 | "나는 부모로서, '만들기' 버튼을 누르면 **데스크톱 기준 5초 이내, 모바일 기준 10초 이내**에 번호가 매겨진 점들이 찍힌 퍼즐 미리보기를 브라우저에서 확인할 수 있어야 한다." | 필수 | 클라이언트 |
| F-04 | 결과물 다운로드 | "나는 부모로서, 완성된 퍼즐을 A4 용지에 바로 인쇄할 수 있도록 고화질 이미지(PNG)로 다운로드할 수 있어야 한다." | 필수 | 클라이언트 |
| F-05 | 이미지 품질 가이드 | "나는 부모로서, 어떤 이미지가 퍼즐로 잘 만들어지는지 예시와 함께 가이드를 볼 수 있어야 한다." | 필수 | 클라이언트 |

### 2.2. Phase 2 기능 (선택)

| 기능 ID | 설명 | 우선순위 |
|---------|------|----------|
| F-06 | PDF 생성 (정답 페이지 포함) | 중 |
| F-07 | 배경 제거 기능 | 중 |
| F-08 | 브라우저 로컬 스토리지에 최근 퍼즐 저장 | 하 |
| F-09 | 색상별 점잇기 (컬러 퍼즐) | 하 |
| F-10 | 숫자 외 힌트 (알파벳, 한글 순서) | 하 |

---

## 3. 기술 아키텍처 개요

### 3.1. 완전 클라이언트 사이드 아키텍처

```
┌─────────────────────────────────────┐
│      사용자 브라우저                 │
│                                     │
│  ┌────────────────────────────────┐│
│  │   Next.js 15 App (React)       ││
│  │                                ││
│  │  ├─ 이미지 업로드 UI           ││
│  │  ├─ Canvas 기반 이미지 처리    ││
│  │  ├─ 엣지 검출 알고리즘         ││
│  │  ├─ 점 배치 로직               ││
│  │  ├─ 번호 매기기                ││
│  │  ├─ 캔버스 미리보기            ││
│  │  └─ PNG 다운로드 생성          ││
│  │                                ││
│  │  모든 처리가 브라우저 내부에서  ││
│  │  완료됨 (서버 통신 없음)       ││
│  └────────────────────────────────┘│
└─────────────────────────────────────┘
               │
               ▼
        ┌─────────────┐
        │   Vercel    │
        │  (정적 호스팅)│
        │  서버 로직 0  │
        └─────────────┘
```

**핵심 장점**
- ✅ 서버 비용 0원 (Vercel 무료 플랜)
- ✅ 무한 확장 가능 (CDN)
- ✅ 프라이버시 보장 (이미지가 서버로 전송 안됨)
- ✅ 오프라인 작동 가능 (PWA로 확장 시)
- ✅ 배포 초간단

### 3.2. 기술 스택

```
프론트엔드
├─ Next.js 15.x (App Router, Turbopack)
├─ React 19.x
├─ TypeScript 5.7.x
├─ Tailwind CSS 4.x
├─ shadcn/ui (UI 컴포넌트)
├─ Zustand 4.5.x (상태 관리)
└─ HTML5 Canvas API (이미지 처리)

이미지 처리 (Web Worker)
├─ Web Worker (메인 스레드 블로킹 방지)
├─ OffscreenCanvas API (Worker에서 Canvas 사용)
├─ Canvas API (픽셀 조작)
├─ ImageData API (픽셀 데이터 접근)
└─ File API (이미지 로드)

출력 생성
├─ Canvas API (PNG 생성)
└─ jsPDF (선택적, PDF 생성)

테스트
├─ Vitest (단위 테스트)
└─ Playwright (E2E 테스트)

배포 및 CI/CD
├─ Vercel (정적 사이트 호스팅)
├─ GitHub (버전 관리)
└─ GitHub Actions (자동화 테스트)
```

**⚠️ 최신 프레임워크 사용 리스크 및 완화 전략**

Next.js 15/React 19/Tailwind 4는 최신 릴리스로 2주 MVP에 다음 리스크가 있습니다:

| 리스크 | 영향 | 완화 전략 |
|--------|------|----------|
| Next.js 15 RC 단계 | 프로덕션 안정성 미검증 | Day 1 빌드 실패 시 즉시 Next.js 14로 롤백 |
| React 19 호환성 | shadcn/ui 일부 컴포넌트 오류 가능 | shadcn 실패 시 Headless UI 대체 (3개 컴포넌트만 필요) |
| Tailwind 4 Beta | 플러그인 미성숙 | 기본 유틸리티만 사용, 커스텀 플러그인 회피 |
| Turbopack 제한 | Webpack 대비 플러그인 부족 | Worker 빌드는 Webpack으로 폴백 가능 |

**롤백 계획**:
```bash
# 문제 발생 시 즉시 안정 버전으로 롤백
pnpm install next@14.2.15 react@18.3.1 react-dom@18.3.1 tailwindcss@3.4.15
```

**최대 리스크 허용 시간**:
- Day 1 종료까지 환경 구축 완료 필수
- 문제 지속 시 Day 2부터 Next.js 14 기반 작업
- 일정 리스크 > 기술 실험 (MVP 우선)

### 3.3. 제약사항 및 한계

**⚠️ 알고리즘 제약 (매우 중요)**

본 애플리케이션은 **가장 큰 외곽선 1개만** 추출하여 퍼즐로 만듭니다. 이는 4살 아이가 사용하기에 적합한 단순한 퍼즐을 만들기 위한 의도적인 설계 결정입니다.

**잘 작동하는 이미지**:
- ✅ **배경이 단색이거나 단순한 이미지** (예: 흰색 배경의 캐릭터)
- ✅ **대상과 배경의 대비가 뚜렷한 이미지** (예: 파란 하늘 배경의 새)
- ✅ **하나의 명확한 주제가 있는 이미지** (예: 단일 동물, 단일 캐릭터)
- ✅ **내부 디테일이 적은 단순한 형태** (예: 만화 캐릭터 실루엣)

**잘 작동하지 않는 이미지**:
- ❌ **복잡한 배경** (풍경, 인테리어, 여러 사물)
- ❌ **대상과 배경이 붙어있거나 대비가 낮은 이미지**
- ❌ **여러 개의 대상이 있는 이미지** (알고리즘은 가장 큰 것 1개만 선택)
- ❌ **내부 디테일이 많은 이미지** (사진, 복잡한 일러스트)

**성능 제약 및 SLA**

Web Worker를 사용하여 UI 블로킹을 방지하지만, 처리 시간은 기기 성능에 따라 다릅니다.

| 항목 | 데스크톱 (권장) | 모바일 (최소) |
|------|----------------|--------------|
| 권장 이미지 크기 | 500x500px ~ 1000x1000px | 500x500px |
| 최대 이미지 크기 | 2000x2000px | 1000x1000px |
| 처리 시간 SLA | **≤ 5초** | **≤ 10초** |
| 테스트 기준 | MacBook Pro M1, Chrome | iPhone 12, Safari |

**성능 가드레일**:
- 이미지 크기가 권장값을 초과하면 경고 메시지 표시
- 2000x2000px 초과 시 자동으로 리사이징
- 처리 시간이 SLA를 초과하면 타임아웃 처리

**기능 제약**
- 자동 배경 제거는 지원하지 않음 (사용자가 미리 배경 제거 필요)
- 내부 디테일(눈, 코, 입 등)은 무시되고 외곽선만 사용됨
- 복잡한 이미지는 **의도적으로** 단순화됨

**브라우저 호환성**

| 브라우저 | 최소 버전 | 처리 방식 | 비고 |
|---------|----------|----------|------|
| Chrome | 94+ | Web Worker (OffscreenCanvas) | ✅ 권장 |
| Firefox | 105+ | Web Worker (OffscreenCanvas) | ✅ 권장 |
| Safari (macOS) | 16.4+ | Web Worker (OffscreenCanvas) | ✅ 권장 |
| Safari (iOS) | 16.4+ | Web Worker (OffscreenCanvas) | ✅ 권장 |
| Safari (iOS) | 15.x 이하 | 메인 스레드 폴백 | ⚠️ UI 일시 정지 |
| Edge | 94+ | Web Worker (OffscreenCanvas) | ✅ 권장 |
| IE11 | - | ❌ 미지원 | - |

**iOS Safari 폴백 전략**:
- iOS Safari 15.x 이하에서는 OffscreenCanvas가 Worker에서 미지원
- 자동으로 메인 스레드 폴백 모드로 전환
- 경고 메시지 표시: "퍼즐 생성 시 화면이 잠시 멈출 수 있습니다"
- 기능은 정상 작동하지만 UI가 3~10초간 응답 없음
- **해결책**: Safari 16.4+ 또는 Chrome 앱 사용 권장

**주 타겟층(iPad/iPhone 사용 아동) 영향**:
- iOS 16.4+ (2023년 3월 출시): Worker 모드 ✅
- iOS 15.x 이하 (2021년 이전): 메인 스레드 폴백 ⚠️
- 2025년 기준 iOS 16+ 점유율 ~80% 예상

---

## 4. 사용자 인터페이스 및 경험

### 4.1. 화면 구성

#### 홈 페이지 (/)
```
┌──────────────────────────────────────────┐
│  🎨 점잇기 퍼즐 생성기                      │
│  사진을 점잇기 퍼즐로 바꿔보세요!           │
├──────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────────┐ │
│  │                                    │ │
│  │      📷                            │ │
│  │                                    │ │
│  │  여기를 클릭하거나                   │ │
│  │  사진을 드래그하세요                 │ │
│  │                                    │ │
│  │  (JPG, PNG 지원)                   │ │
│  │                                    │ │
│  └────────────────────────────────────┘ │
│                                          │
│  💡 팁: 배경이 단순한 이미지가 좋아요!     │
│                                          │
│  [좋은 예시 보기]  [나쁜 예시 보기]       │
│                                          │
└──────────────────────────────────────────┘
```

#### 편집 페이지 (/editor)
```
┌──────────────────────────────────────────────────────────┐
│  ← 뒤로                    🎨 점잇기 퍼즐 생성기          │
├────────────────────┬─────────────────────────────────────┤
│                    │                                     │
│  원본 이미지        │  설정                                │
│                    │                                     │
│  ┌──────────────┐  │  난이도 조절                         │
│  │              │  │  ●────────────────○                 │
│  │   [이미지]    │  │  쉬움              어려움             │
│  │              │  │  (약 25개의 점)                      │
│  │              │  │                                     │
│  └──────────────┘  │  시작 위치                           │
│                    │  ◉ 왼쪽 위  ○ 오른쪽 위  ○ 가운데    │
│  [다른 사진 선택]   │                                     │
│                    │  [퍼즐 만들기! 🎨]                   │
│                    │                                     │
├────────────────────┴─────────────────────────────────────┤
│                                                          │
│  미리보기                                                 │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                    │ │
│  │        ●1    ●2                                    │ │
│  │                  ●3                                │ │
│  │      ●7                ●4                          │ │
│  │                            ●5                      │ │
│  │        ●6                                          │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  [PNG 다운로드 📥]                                        │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 4.2. 사용자 플로우

```
1. 홈페이지 접속
   ↓
2. 이미지 선택 (드래그 또는 클릭)
   ↓
3. 편집 페이지로 자동 이동
   ↓
4. 난이도 조절 (슬라이더)
   ↓
5. "퍼즐 만들기" 버튼 클릭
   ↓
6. 로딩 (2~10초)
   ↓
7. 미리보기 표시
   ↓
8. 마음에 들면 "PNG 다운로드"
   ↓
9. 파일 저장 → 인쇄
```

### 4.3. 로딩 및 에러 처리

**로딩 상태**
```
처리 중입니다...
━━━━━━━━━━━━━━ 60%

1. 이미지 불러오는 중... ✓
2. 엣지 검출 중... ⏳
3. 점 배치 중...
4. 번호 매기는 중...
```

**에러 메시지**
- "이미지 파일이 너무 커요. 2MB 이하의 이미지를 사용해주세요."
- "이 이미지는 윤곽이 불분명해서 퍼즐로 만들기 어려워요. 배경이 단순한 이미지를 선택해주세요."
- "브라우저에서 처리할 수 없는 형식이에요. JPG나 PNG 파일을 사용해주세요."

---

## 5. 알고리즘 설계 (클라이언트 사이드)

### 5.1. 이미지 처리 파이프라인

```
원본 이미지 (File)
    ↓
Canvas에 그리기
    ↓
ImageData 추출
    ↓
그레이스케일 변환
    ↓
엣지 검출 (Sobel Filter)
    ↓
윤곽선 추출
    ↓
Douglas-Peucker 알고리즘 (점 단순화)
    ↓
점 번호 매기기
    ↓
출력 (Canvas → PNG)
```

### 5.2. 핵심 알고리즘 간략 설명

#### 5.2.1. 그레이스케일 변환
```javascript
// RGB → Grayscale
gray = 0.299 * R + 0.587 * G + 0.114 * B
```

#### 5.2.2. Canny 엣지 검출 (Sobel 대신)
**중요**: Sobel 필터는 모든 내부 디테일을 검출하여 부적합합니다. Canny를 사용합니다.

```
1. Gaussian Blur (노이즈 제거)
2. Sobel 그라디언트 계산
3. Non-maximum Suppression
4. Double Threshold
5. Edge Tracking by Hysteresis
```

#### 5.2.3. 윤곽선 추출
- 이진화 (Canny 결과)
- 연결된 컴포넌트 찾기
- 시계 방향으로 경계선 추적 (순서 보존)
- **⭐ 가장 긴 윤곽선 1개만 선택**

#### 5.2.4. Douglas-Peucker 알고리즘
- 점들의 집합을 단순화 (**순서 보존**)
- epsilon 값으로 정밀도 조절
- 난이도에 따라 epsilon 조절 (0→50, 100→5)

#### 5.2.5. 최소 거리 필터링
- Douglas-Peucker 결과에서 너무 가까운 점 제거
- 번호가 겹치지 않도록 최소 거리(20px) 보장

#### 5.2.6. 번호 매기기
- 시작점의 **인덱스**를 찾음 (좌상단/우상단/중앙)
- 배열을 회전(rotate)하여 시작점부터 시작
- **⚠️ Nearest Neighbor 재정렬 금지** (순서 파괴됨)

---

## 6. 성능 및 품질 기준

### 6.1. 성능 목표

| 항목 | 데스크톱 목표 | 모바일 목표 | 측정 방법 |
|------|--------------|------------|-----------|
| 초기 로딩 시간 | < 2초 | < 3초 | Lighthouse |
| 퍼즐 생성 시간 (500x500px) | **< 3초** | **< 5초** | Performance API |
| 퍼즐 생성 시간 (1000x1000px) | **< 5초** | **< 10초** | Performance API |
| PNG 다운로드 생성 | < 1초 | < 2초 | Performance API |
| 번들 크기 (gzip) | < 500KB | < 500KB | webpack-bundle-analyzer |
| UI 응답성 (Worker 사용) | 메인 스레드 블로킹 없음 | 메인 스레드 블로킹 없음 | Chrome DevTools Performance |

**테스트 환경**:
- 데스크톱: MacBook Pro M1, Chrome 120+
- 모바일: iPhone 12 / Galaxy S21, Safari / Chrome

### 6.2. 품질 기준

| 항목 | 기준 |
|------|------|
| 점 배치 정확도 | 원본 형태의 70% 이상 재현 |
| 번호 가독성 | 인쇄 시 모든 번호 구분 가능 |
| 출력물 해상도 | 300 DPI (A4 기준) |
| 브라우저 호환성 | Chrome 90+, Safari 14+, Firefox 88+, Edge 90+ |

### 6.3. 사용자 경험 기준

| 항목 | 기준 |
|------|------|
| 사용자 만족도 | 4.0/5.0 이상 |
| 작업 완료율 | 80% 이상 (업로드 → 다운로드) |
| 반복 사용률 | 30% 이상 |

---

## 7. 제약사항 및 가정

### 7.1. 기술적 제약사항

**이미지 크기**
- 최대 파일 크기: 5MB
- 최대 해상도: 2000x2000px
- 권장 해상도: 500x500px ~ 1000x1000px

**지원 형식**
- JPG, JPEG
- PNG
- WebP (Chrome, Edge)

**브라우저 제약**
- JavaScript 활성화 필수
- Canvas API 지원 필수
- FileReader API 지원 필수

### 7.2. 사용자 기대치 관리

**잘 작동하는 이미지**
- 배경이 단색이거나 단순한 이미지
- 윤곽이 명확한 캐릭터, 동물
- 대비가 좋은 이미지

**잘 작동하지 않는 이미지**
- 복잡한 배경 (풍경, 인테리어 등)
- 윤곽이 불분명한 이미지
- 대비가 낮은 이미지

→ 홈페이지에 "좋은 예시 / 나쁜 예시" 가이드 제공

---

## 8. 향후 계획 (Phase 2 이후)

### Phase 2 (출시 후 1~2개월)
- **PDF 생성**: jsPDF를 사용하여 정답 페이지 포함 PDF 생성
- **배경 제거**: Remove.bg API 또는 클라이언트 사이드 ML 모델
- **로컬 저장**: 브라우저 localStorage에 최근 퍼즐 저장

### Phase 3 (출시 후 3~6개월)
- **PWA 변환**: 오프라인에서도 작동
- **다국어 지원**: 영어, 일본어 등
- **공유 기능**: URL로 퍼즐 공유 (이미지는 Base64 인코딩)

### Phase 4 (장기)
- **모바일 앱**: React Native로 네이티브 앱 개발
- **디지털 점잇기**: 터치로 직접 점을 잇는 인터랙티브 모드
- **AI 추천**: 아이 연령대에 적합한 이미지 추천

---

## 9. 성공 지표 (Metrics)

### 9.1. 출시 후 1개월 목표

| 지표 | 목표 |
|------|------|
| 순 방문자 수 (UV) | 1,000명 |
| 퍼즐 생성 횟수 | 3,000회 |
| 평균 체류 시간 | 5분 이상 |
| 완료율 (다운로드까지) | 60% 이상 |
| 재방문율 | 20% 이상 |

### 9.2. 피드백 수집 방법

- Google Analytics 설치
- 간단한 별점 피드백 버튼 (👍 / 👎)
- 선택적 한 줄 의견 수집

---

## 10. 리스크 및 대응 방안

### 10.1. 기술적 리스크

| 리스크 | 영향 | 확률 | 대응 방안 |
|--------|------|------|-----------|
| 브라우저 성능 부족 | 높음 | 중 | 이미지 크기 제한, 최적화, 경고 메시지 |
| 엣지 검출 정확도 낮음 | 중 | 중 | 알고리즘 튜닝, 사용자 가이드 강화 |
| 구형 브라우저 미지원 | 낮음 | 낮음 | 최신 브라우저 사용 권장 메시지 |

### 10.2. 사용자 경험 리스크

| 리스크 | 영향 | 확률 | 대응 방안 |
|--------|------|------|-----------|
| 기대에 못 미치는 결과물 | 높음 | 중 | 예시 이미지 제공, 기대치 관리 |
| 사용법을 모름 | 중 | 낮음 | 직관적 UI, 툴팁, 가이드 페이지 |
| 느린 처리 속도 | 중 | 중 | 로딩 표시, 진행률 표시, 예상 시간 안내 |

---

## 11. 법적 고려사항

### 11.1. 저작권
- 사용자가 업로드하는 이미지의 저작권은 사용자 책임
- 이용 약관에 "개인 용도로만 사용" 명시
- 저작권이 있는 캐릭터 이미지 사용 주의 안내

### 11.2. 개인정보 보호
- 이미지가 서버로 전송되지 않으므로 개인정보 처리 없음
- Google Analytics 사용 시 쿠키 동의 배너 표시

---

## 부록 A: 예시 이미지

### 좋은 예시
1. ✅ 흰색 배경의 검은 고양이 실루엣
2. ✅ 파란 하늘 배경의 새
3. ✅ 단순한 만화 캐릭터 (뽀로로, 핑크퐁 등)

### 나쁜 예시
1. ❌ 복잡한 배경의 인물 사진
2. ❌ 풍경 사진
3. ❌ 저대비 이미지

---

